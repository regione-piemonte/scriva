<!--
 * ========================LICENSE_START=================================
 * 
 * Copyright (C) 2025 Regione Piemonte
 * 
 * SPDX-FileCopyrightText: (C) Copyright 2025 Regione Piemonte
 * SPDX-License-Identifier: EUPL-1.2
 * =========================LICENSE_END==================================
-->
<scriva-bread-crumb *ngIf="istanza && scrivaBreadCrumbItems" [items]="scrivaBreadCrumbItems"
    (emit)="emitEventChild($event)">
</scriva-bread-crumb>

<!-- TITOLO DELLA PAGINA -->
<scriva-page-title *ngIf="istanza && titlePage" [title]="titlePage" [showUserInfo]="false">
</scriva-page-title>


<!-- <advanced-action-riepilogo-istanza
  *ngIf="istanza && denTitolareIstanza"
  [istanza]="istanza"
  [denTitolareIstanza]="denTitolareIstanza">
</advanced-action-riepilogo-istanza> -->

<div class="card" *ngIf="!modeSuccess">
    <h2 class="title mb-4">
        <strong>Istanza di riferimento</strong>
    </h2>

    <div class="row info">
        <div class="col-xl-12 col-md-6">
            <p>Soggetto titolare</p>
            <p class="info-value"> {{ denTitolareIstanza }} </p>
        </div>
        <div class="col-xl-3 col-md-6">
            <p>Identificativo istanza</p>
            <p class="info-value"> {{ istanza?.cod_istanza }} </p>
        </div>
        <div class="col-xl-3 col-md-6">
            <p>Data inserimento</p>
            <p class="info-value"> {{ istanza?.data_inserimento_istanza | date: 'dd/MM/yyyy - H:mm:ss' }} </p>
        </div>
        <div class="col-xl-3 col-md-6">
            <p>Stato procedimento</p>
            <p class="info-value capitalize"> {{ istanza?.stato_istanza.descrizione_stato_istanza }} </p>
        </div>
    </div>
</div>

<ng-container *ngIf="!modeSuccess; else modeSuccessTemplate">
    <div class="card" id="dettaglioContainer">

        <form [formGroup]="infoForm">
            <div class="row" *ngIf="acList?.length > 1">
                <div class="form-group col-xl-auto col-md-6">
                    <label for="ac">Seleziona l'autorit√† competente di riferimento</label>
                </div>
                <div class="form-group col-xl-4 col-md-6">
                    <select class="form-control" name="ac" id="ac" formControlName="ac" [compareWith]="compareAC">
                        <option [value]="null" class="option-hidden">Seleziona</option>
                        <option [ngValue]="ac" *ngFor="let ac of acList">
                            {{ ac.des_competenza_territorio }}
                        </option>
                    </select>
                </div>
            </div>
        </form>

        <advanced-action-allegati *ngIf="istanza" [istanza]="istanza" [chiave]="chiave" (emit)="emitEventChild($event)">
        </advanced-action-allegati>

        <scriva-note [noteIstanza]="noteIstanza" (emit)="emitEventChild($event)" [idIstanza]="idIstanza">
        </scriva-note>
    </div>
</ng-container>

<advanced-action-footer [showConferma]="selectedAC && !modeSuccess" (emit)="emitEventChild($event)">
</advanced-action-footer>

<!-- Messaggio di succes  della azione avanzata -->
<ng-template #modeSuccessTemplate>
    <div class="row s-mt--30">
        <div class="col">
            <div class="alert-box success">
                <i class="icon icon-big fa fa-check-circle-o" aria-hidden="true"></i>
                <span>
                    <p class="text-only" [innerHTML]="confirmSuccessMessagge"></p>
                </span>
            </div>
        </div>
    </div>
</ng-template>