<!--
 * ========================LICENSE_START=================================
 * 
 * Copyright (C) 2025 Regione Piemonte
 * 
 * SPDX-FileCopyrightText: (C) Copyright 2025 Regione Piemonte
 * SPDX-License-Identifier: EUPL-1.2
 * =========================LICENSE_END==================================
-->
<scriva-bread-crumb
  *ngIf="istanza && scrivaBreadCrumbItems"
  [items]="scrivaBreadCrumbItems"
  (emit)="emitEventChild($event)"
></scriva-bread-crumb>

<!-- TITOLO DELLA PAGINA -->
<scriva-page-title
  *ngIf="istanza && titlePage"
  [title]="titlePage"
  [showUserInfo]="false"
></scriva-page-title>


<advanced-action-riepilogo-istanza
  *ngIf="istanza && denTitolareIstanza"
  [istanza]="istanza"
  [denTitolareIstanza]="denTitolareIstanza"
>
</advanced-action-riepilogo-istanza>

<!-- Core della azione avanzata -->
<ng-container *ngIf="!modeSuccess; else modeSuccessTemplate">
  <div class="card" id="dettaglioContainer">
      <form [formGroup]="dettaglioForm">
        <div class="row">
          <div class="form-group col-md-6">
            <label for="data">Data di protocollo*</label>
            <input type="date" class="form-control" id="data" formControlName="dataProtocolloIstanza"max="{{ today | date: 'yyyy-MM-dd' }}"/>
            <app-form-error-message [control]="dettaglioForm.get('dataProtocolloIstanza')"></app-form-error-message>
          </div>
          <div class="form-group col-md-6">
            <label for="numero">Numero di protocollo*</label>
            <input type="text" class="form-control" [maxlength]="numProtocolloIstanzaMaxLen" formControlName="numProtocolloIstanza"/>
            <app-form-error-message [control]="dettaglioForm.get('numProtocolloIstanza')"></app-form-error-message>
          </div>
        </div>
        <div class="row">
          <div class="form-group col-md-6">
            <label for="data">Termine procedimento</label>
            <input type="date" class="form-control" id="data" formControlName="dataScadenzaProcedimento"/>
          </div>
          <div class="form-group col-md-6">
            <label for="annoRegistro">Anno registro*</label>
            <input type="text" class="form-control" formControlName="annoRegistro" [readonly]="istanza?.cod_pratica"/>
            <app-form-error-message [control]="dettaglioForm.get('annoRegistro')"></app-form-error-message>
          </div>
        </div>
        <p><small class="form-text text-muted">*Campo obbligatorio</small></p>
      </form>

      <advanced-action-responsabili
          *ngIf="istanza"  
          [istanza]="istanza"
          [responsabili]="responsabili"
          [tipiResponsabile]="tipiResponsabile"
          [istanzaCompetenzaList]="istanzaCompetenzaList"
          (emit)="emitEventChild($event)"
        >
      </advanced-action-responsabili>
      
      <advanced-action-allegati
        *ngIf="istanza"
        [istanza]="istanza"
        [chiave]="chiave"
        (emit)="emitEventChild($event)"
      >
      </advanced-action-allegati>
      <scriva-note 
        [idIstanza]="idIstanza"
        (emit)="emitEventChild($event)"
      ></scriva-note>
  </div>
</ng-container>

<advanced-action-footer
  [showConferma]="!modeSuccess"
  [disable]="!dettaglioForm.valid"
  (emit)="emitEventChild($event)">
</advanced-action-footer>

<!-- Messaggio di succes  della azione avanzata -->
<ng-template #modeSuccessTemplate>
  <div class="row s-mt--30">
    <div class="col">
      <div class="alert-box success">
        <i class="icon icon-big fa fa-check-circle-o" aria-hidden="true"></i>
        <span>
          <p class="text-only" [innerHTML]="confirmSuccessMessagge"></p>
        </span>
      </div>    
    </div>
  </div>
</ng-template>
