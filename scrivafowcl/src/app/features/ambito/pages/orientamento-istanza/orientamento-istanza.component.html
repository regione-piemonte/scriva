<!--
 * ========================LICENSE_START=================================
 * 
 * Copyright (C) 2025 Regione Piemonte
 * 
 * SPDX-FileCopyrightText: (C) Copyright 2025 Regione Piemonte
 * SPDX-License-Identifier: EUPL-1.2
 * =========================LICENSE_END==================================
-->
<div class="page-container" id="pageContainer">
  <p class="bread-crumb" *ngIf="tipoAdempimento">
    <a href="javascript:;" (click)="goToDashboard()" aria-label="ambito dashboard">{{ tipoAdempimento.ambito.des_ambito }}</a> - <strong> {{ tipoAdempimento.cod_tipo_adempimento }}</strong>
  </p>
  <h1 class="heel">{{ title }}</h1>

  <div class="card" id="card">
    <div class="row">
      <div class="help-text-wrapper col-md">
        <h3><strong>Seleziona il procedimento per la presentazione dell'istanza.</strong></h3>
        <button class="btn btn-primary help-btn" (click)="onHelpClicked('seleziona_adempimento')" aria-label="help">
          <i class="fa fa-question-circle fa-lg" aria-hidden="true"></i>
        </button>
      </div>
    </div>
    <small class="form-text text-muted">*Campo obbligatorio</small>

    <form [formGroup]="adempimentoForm">
      <div class="row">
        <div class="form-group col-xl-3 col-md-6">
          <label for="adempimento">*Procedimento</label>
          <select class="form-control" name="adempimento" id="adempimento" formControlName="adempimento" [compareWith]="compareAdempimento">
            <option [value]="null" class="option-hidden">Seleziona</option>
            <option [ngValue]="ademp" *ngFor="let ademp of adempimenti">
              {{ ademp.des_adempimento }}
            </option>
          </select>
        </div>
      </div>

      <div class="row">
        <div class="col">
          <span id="seleziona_adempimento"></span>
        </div>
      </div>

      <ng-container *ngIf="selectedAdempimento && acList">
        <div class="row row-ac">
          <div class="help-text-wrapper col-md">
            <h3><strong>Seleziona l'autorità competente</strong></h3>
            <button class="btn btn-primary help-btn" (click)="onHelpClicked('seleziona_acpratica')" aria-label="help">
              <i class="fa fa-question-circle fa-lg" aria-hidden="true"></i>
            </button>
          </div>
        </div>
        <div class="row">
          <div class="form-group col-xl-3 col-md-6">
            <label for="ac">*Autorità competente</label>
            <select class="form-control" name="autoritaCompetente" id="ac" formControlName="autCompetente"
              [compareWith]="compareAC"
              (change)="onChangeAutoritaCompetente(true)"
            >
              <option [value]="null" class="option-hidden">Seleziona</option>
              <option [ngValue]="ac" *ngFor="let ac of acList">
                {{ ac.des_competenza_territorio }}
              </option>
            </select>
          </div>
          <div class="form-group col-md-2" *ngIf="IndTipoSelezioneAC === 'M'">
            <button class="btn btn-large btn-link" type="button" [disabled]="!showBtnAC" (click)="aggiungiAC()">
              <img src="assets/icon-page-add.svg" class="add-icon" alt="Aggiungi">
              <strong>AGGIUNGI</strong>
            </button>
          </div>
        </div>

        <div class="row" *ngIf="acTableRecords.length > 0">
          <div class="form-group col-md">
            <div class="card ac-card">
              <app-recap-table
                [title]="acTableTitle"
                [columns]="acTableColumns"
                [records]="acTableRecords"
                [editEnabled]="false"
                [detailEnabled]="false"
                [deleteEnabled]="showBtnAC"
                [selectionType]="'N'"
                (deleteRecord)="eliminaAC($event)"
              >
              </app-recap-table>
            </div>
          </div>
        </div>
      </ng-container>
    </form>

    <ng-container *ngIf="visualizzaInfoPrivacy && selectedAdempimento && orientamentoForm && (IndTipoSelezioneAC === 'N' || selectedAC.length > 0)">
      <div *ngIf="formIoReady">
        <formio #ngFormio
          [options]="formioOptions"
          [form]="orientamentoForm"
          [submission]="submission"
          [renderOptions]="renderOptions"
          [readOnly]="readOnly"
          (change)="onFormioChange($event)"
          (customEvent)="onCustomEvent($event)"
        ></formio>
      </div>
    </ng-container>
  </div>

  <div class="buttons-container">
    <div>
      <button class="btn btn-large btn-link" (click)="onIndietro()">
        INDIETRO
      </button>
    </div>
    <div>
      <button class="btn btn-large btn-primary btn-prosegui" *ngIf="showProsegui && enableProsegui_VINCA" (click)="onProsegui()">
        PROSEGUI
      </button>
<!--       <button class="btn btn-large btn-link" *ngIf="!enableProsegui_VINCA" (click)="goToHome()">
        TORNA ALLA HOME PAGE
      </button> -->
    </div>
  </div>

</div>
