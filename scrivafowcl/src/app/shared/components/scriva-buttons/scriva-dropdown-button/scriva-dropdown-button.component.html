<!--
 * ========================LICENSE_START=================================
 * 
 * Copyright (C) 2025 Regione Piemonte
 * 
 * SPDX-FileCopyrightText: (C) Copyright 2025 Regione Piemonte
 * SPDX-License-Identifier: EUPL-1.2
 * =========================LICENSE_END==================================
-->
<!-- ######################### -->
<!-- ######################### -->
<!-- CONTAINER PER LA DROPDOWN -->
<!-- ######################### -->
<!-- ######################### -->
<div ngbDropdown #scrivaBtnDD="ngbDropdown" class="d-inline-block"
  [autoClose]="ngbDDAutoClose"
  [container]="ngbDDContainer"
  [display]="ngbDDDisplay"
  [open]="ngbDDOpen"
  [placement]="ngbDDPlacement"
  (openChange)="onOpenChange($event)"

  [ngClass]="ngbDDCss | scrivaCssHandler:C_C.CSS_TYPE_CLASS"
  [ngStyle]="ngbDDCss | scrivaCssHandler:C_C.CSS_TYPE_STYLE"
>
  <!-- ################################### -->
  <!-- PULSANTE DI GESTIONE DELLA DROPDOWN -->
  <!-- ################################### -->
  <ng-container>
    <button ngbDropdownToggle type="button" class="btn s-btn-dropdown" [id]="idDOM"
      [attr.title]="dataConfig?.label || ''"
      [disabled]="disabled"
      [ngClass]="[(cssConfig?.customButton | scrivaCssHandler:C_C.CSS_TYPE_CLASS), typeButton]"
      [ngStyle]="cssConfig?.customButton | scrivaCssHandler:C_C.CSS_TYPE_STYLE"
      (click)="scrivaBtnDD.toggle()"
    >
      <!-- CONTENUTO CON LABEL E FRECCETTA PER APERTURA/CHIUSURA DROPDOWN -->
      <ng-container *ngTemplateOutlet="ngbDDA_label"></ng-container>
    </button>
  </ng-container>

  <!-- LISTA DEI PULSANTI PER LA DROPDOWN -->
  <div ngbDropdownMenu [attr.aria-labelledby]="idDOM">
    <!-- ITERAZIONE DELLA LISTA DI ITEMS PER LA DROPDOWN -->
    <ng-container *ngFor="let item of dataConfig?.dropdownItems">
      <!-- BUTTON/ITEM DELLA DROPDOWN -->
      <button ngbDropdownItem [id]="item.id" class="s-dropdown-item"
        [disabled]="item.disabled"
        [ngClass]="[cssConfig.customItems | scrivaCssHandler:C_C.CSS_TYPE_CLASS, item.itemCss | scrivaCssHandler:C_C.CSS_TYPE_CLASS]"
        [ngStyle]="cssConfig.customItems | scrivaStylesHandler:item.itemCss"

        (click)="itemClick(item)"
      >

        <!-- ICONA DI SINISTRA -->
        <ng-container *scrivaMaintain="item.useIcon && item.useIconLeft"
          [ngTemplateOutlet]="ngbDDA_ICON"
          [ngTemplateOutletContext]="{ icon: item.iconLeft }"
        ></ng-container>

        <!-- LABEL DEL PULSANTE -->
        {{ item.label }}

        <!-- ICONA DI DESTRA -->
        <ng-container *scrivaMaintain="item.useIcon && item.useIconRight" 
          [ngTemplateOutlet]="ngbDDA_ICON"
          [ngTemplateOutletContext]="{ icon: item.iconRight }"
        ></ng-container>

      </button>
    </ng-container>
  </div>
</div>

<!-- TEMPLATE PER IL CONTENUTO DEL PULSANTE PRINCIPALE DI DROPDOWN -->
<ng-template #ngbDDA_label>
  <!-- LABEL DEL PULSANTE DROPDOWN -->
  {{ dataConfig?.label || '' }}
  
  <!-- CONTAINER PER L'ICONA DELLA DROPDOWN -->
  <div class="s-dropdown-icon" [ngClass]="typeButtonSvg">
    <!-- GESTIONE DELL'ICONA CHE DEFINISCE SE LA DROPDOWN E' APERTA O CHIUSA -->
    <ng-container *ngIf="isOpen; then isCloseIcon else isOpenIcon"></ng-container>
  </div>
</ng-template>

<!-- TEMPLATE CON LA CONFIGURAZIONE PER UNA ScrivaIcon -->
<ng-template #ngbDDA_ICON let-icon="icon">
  <scriva-icon
    [classes]="icon.classes"
    [icon]="icon.icon"
    [iconStyles]="icon.iconStyles"
    [iconTitle]="icon.iconTitle"
    [disabled]="icon.disabled"
    [useDefault]="icon.useDefault"
  ></scriva-icon>
</ng-template>

<!-- TEMPLATE CON LA CONFIGURAZIONE L'ICONA DELLA DROPDOWN APERTA -->
<ng-template #isOpenIcon>
  <svg xmlns="http://www.w3.org/2000/svg" id="rddb-icon-open" width="16.339" height="16.339" viewBox="0 0 16.339 16.339" fill="none" stroke="currentColor" stroke-width="2px">
    <path d="M10.395,10.712H0V0" transform="translate(0.707 7.35) rotate(-45)"/>
  </svg>
</ng-template>

<!-- TEMPLATE CON LA CONFIGURAZIONE L'ICONA DELLA DROPDOWN CHIUSA -->
<ng-template #isCloseIcon>
  <svg xmlns="http://www.w3.org/2000/svg" id="rddb-icon-close" width="16.339" height="16.339" viewBox="0 0 16.339 16.339" fill="none" stroke="currentColor" stroke-width="2px">
    <path d="M10.395,10.712H0V0" transform="translate(15.632 8.989) rotate(135)"/>
  </svg>
</ng-template>

